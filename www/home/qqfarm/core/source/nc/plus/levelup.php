<?php

# Upgrade Tips

$levelups = array(
	"200" => array("eDesc" => "2 hạt giống bắp", "eType" => "1", "eParam" => "4", "eNum" => "2", "name" => "Bắp", "level" => 1),
	"600" => array("eDesc" => "2 bao phân bón (nhỏ)", "eType" => "3", "eParam" => "1", "eNum" => "2", "name" => "Phân bón (nhỏ)", "level" => 2),
	"1200" => array("eDesc" => "2 hạt giống trứng gà", "eType" => "1", "eParam" => "6", "eNum" => "2", "name" => "Trứng gà", "level" => 3),
	"2000" => array("eDesc" => "2 hạt giống cà chua", "eType" => "1", "eParam" => "7", "eNum" => "2", "name" => "Cà chua", "level" => 4),
	"3000" => array("eDesc" => "2 bao phân bón (vừa)", "eType" => "3", "eParam" => "2", "eNum" => "2", "name" => "Phân bón (vừa)", "level" => 5),
	"4200" => array("eDesc" => "2 hạt giống ớt", "eType" => "1", "eParam" => "9", "eNum" => "2", "name" => "Ớt", "level" => 6),
	"5600" => array("eDesc" => "2 hạt giống bí ngô", "eType" => "1", "eParam" => "10", "eNum" => "2", "name" => "Bí ngô", "level" => 7),
	"7200" => array("eDesc" => "2 hạt giống táo", "eType" => "1", "eParam" => "11", "eNum" => "2", "name" => "Táo", "level" => 8),
	"9000" => array("eDesc" => "2 hạt giống dâu tây", "eType" => "1", "eParam" => "1", "eNum" => "2", "name" => "Dâu tây", "level" => 9),
	"11000" => array("eDesc" => "2 bao phân bón cao cấp", "eType" => "3", "eParam" => "3", "eNum" => "2", "name" => "Phân bón cấp cao", "level" => 10),
	"13200" => array("eDesc" => "2 hạt giống chuối", "eType" => "1", "eParam" => "15", "eNum" => "2", "name" => "Chuối", "level" => 11),
	"15600" => array("eDesc" => "2 hạt giống đậu Hà Lan", "eType" => "1", "eParam" => "18", "eNum" => "2", "name" => "Đậu Hà Lan", "level" => 12),
	"18200" => array("eDesc" => "2 hạt giống cam", "eType" => "1", "eParam" => "19", "eNum" => "2", "name" => "Cam", "level" => 13),
	"21000" => array("eDesc" => "2 hạt giống nho", "eType" => "1", "eParam" => "13", "eNum" => "2", "name" => "Nho", "level" => 14),
	"24000" => array("eDesc" => "3 bao phân bón cao cấp", "eType" => "3", "eParam" => "3", "eNum" => "3", "name" => "Phân bón cao cấp", "level" => 15),
	"27200" => array("eDesc" => "2 hạt giống bưởi", "eType" => "1", "eParam" => "26", "eNum" => "2", "name" => "Bưởi", "level" => 16),
	"30600" => array("eDesc" => "2 hạt giống dứa", "eType" => "1", "eParam" => "27", "eNum" => "2", "name" => "Dứa", "level" => 17),
	"34200" => array("eDesc" => "5 bao phân bón cao cấp", "eType" => "3", "eParam" => "3", "eNum" => "5", "name" => "Phân bón cao cấp", "level" => 18),
	"38000" => array("eDesc" => "2 hạt giống bầu", "eType" => "1", "eParam" => "31", "eNum" => "2", "name" => "Bầu", "level" => 19),
	//type for the decoration of the type ...
	"42000" => array("eDesc" => "[Phông nền] Cánh đồng hoa", "eType" => "2", "eParam" => "253", "eNum" => "1", "type"=>"1", "name" => "[Phông nền] Cánh đồng hoa", "level" => 20),
	"46200" => array("eDesc" => "[Hàng rào] Cánh đồng hoa", "eType" => "2", "eParam" => "255", "eNum" => "1", "type"=>"3", "name" => "[Hàng rào] Cánh đồng hoa", "level" => 21),
	"50600" => array("eDesc" => "[Cũi chó] Cánh đồng hoa", "eType" => "2", "eParam" => "256", "eNum" => "1", "type"=>"4", "name" => "[Cũi chó] Cánh đồng hoa", "level" => 22),
	"55200" => array("eDesc" => "[Căn nhà] Cánh đồng hoa", "eType" => "2", "eParam" => "254", "eNum" => "1", "type"=>"2", "name" => "[Căn nhà] Cánh đồng hoa", "level" => 23),
	"60000" => array("eDesc" => "10 Bao phân bón cao cấp", "eType" => "3", "eParam" => "3", "eNum" => "10", "name" => "Phân bón cao cấp", "level" => 24),
	"65000" => array("eDesc" => "2 hạt giống chanh", "eType" => "1", "eParam" => "42", "eNum" => "2", "name" => "Chanh", "level" => 25),
	"70200" => array("eDesc" => "2 hạt giống sơn trà", "eType" => "1", "eParam" => "55", "eNum" => "2", "name" => "Sơn trà", "level" => 26),
	"75600" => array("eDesc" => "2 hạt giống mía", "eType" => "1", "eParam" => "47", "eNum" => "2", "name" => "Mía", "level" => 27),
	"81200" => array("eDesc" => "2 hạt giống nấm", "eType" => "1", "eParam" => "50", "eNum" => "2", "name" => "Nấm", "level" => 28),
	"87000" => array("eDesc" => "2 hạt giống thanh mai", "eType" => "1", "eParam" => "48", "eNum" => "2", "name" => "Thanh mai", "level" => 29),
	"93000" => array("eDesc" => "2 hạt giống hồng vàng", "eType" => "1", "eParam" => "80", "eNum" => "2", "name" => "Hồng vàng", "level" => 30)
);


$levelup_exp = $levelup; //Before the query must include the value out of levelup
$vip1 = $_QFG['db']->result("SELECT vip FROM app_qqfarm_user where uid=" . $_QFG['uid']);
$vip1 = qf_decode($vip1);
$listup = $_QFG['db']->fetchOne("SELECT package,tools,decorative FROM app_qqfarm_nc where uid=" . $_QFG['uid']);
$package = qf_decode($listup['package']);
$fertilizer = qf_decode($listup['tools']);
$decorative = qf_decode($listup['decorative']);
//VIP-level reading, according to the different VIP levels of delivery

//Message
if((int)$vip1['valid'] > $_QFG['timestamp']) {
	$vipquantity = 2;
	$levelup_arr = '{"title":"Phần thưởng thăng cấp","direction":" Chúc mừng bạn đã đã đạt cấp ' . $levelups[$levelup_exp]['level'] . ', hội trưởng có món quà nhỏ tặng bạn: ' . $levelups[$levelup_exp]['eDesc'] . '","item":[{"eType":"' . $levelups[$levelup_exp]['eType'] . '","eParam":"' . $levelups[$levelup_exp]['eParam'] . '","eNum":"' . $levelups[$levelup_exp]['eNum'] . '"}],"level":' . $levelups[$levelup_exp]['level'] . ',"vipItem":[{"eType":"' . $levelups[$levelup_exp]['eType'] . '","eParam":"' . $levelups[$levelup_exp]['eParam'] . '","eNum":"' . $levelups[$levelup_exp]['eNum'] . '"}],"vipText":"Ưu đãi dành cho hội viên:"}';	
} else{
	$vipquantity = 1;
	$levelup_arr = '{"title":"Phần thưởng thăng cấp","direction":" Chúc mừng bạn đã đã đạt cấp ' . $levelups[$levelup_exp]['level'] . ', hội trưởng có món quà nhỏ tặng bạn: ' . $levelups[$levelup_exp]['eDesc'] . '","item":[{"eType":"' . $levelups[$levelup_exp]['eType'] . '","eParam":"' . $levelups[$levelup_exp]['eParam'] . '","eNum":"' . $levelups[$levelup_exp]['eNum'] . '"}],"level":' . $levelups[$levelup_exp]['level'] . '}';
}

//Update the database
$levelup_sql = "";
if(1 == $levelups[$levelup]['eType']) {
	$zhongzi = $levelups[$levelup_exp]['eParam'];
	$package[$zhongzi] = $package[$zhongzi] + $levelups[$levelup_exp]['eNum'] * $vipquantity;
	$levelup_sql = ",package='".qf_encode($package)."'";//种子
} elseif(2 == $levelups[$levelup_exp]['eType']) {
	$decType = $levelups[$levelup_exp]['type']; //类型
	$decID = $levelups[$levelup_exp]['eParam']; //Decorative ID
	foreach((array)$decorative as $item_type => $value) {
		foreach((array)$value as $key1 => $value1) {
			if($key1 == $decID) {
				$buyed = 1;
				$decorative[$decType][$decID]['validtime'] += $itemtype[$decID]['itemValidTime'] * $vipquantity;
			}
		}
	}
	if(!$buyed) {
		$decorative[$decType][$decID]['status'] = 0;
		$decorative[$decType][$decID]['validtime'] = $_QFG['timestamp'] + $itemtype[$decID]['itemValidTime'] * $vipquantity;
	}
	$levelup_sql = ",decorative='".qf_encode($decorative)."'";//装饰
} elseif(3 == $levelups[$levelup_exp]['eType']) {
	$gongju = $levelups[$levelup_exp]['eParam'];
	$fertilizer[$gongju] = $fertilizer[$gongju] + $levelups[$levelup_exp]['eNum'] * $vipquantity;
	$levelup_sql = ",tools='".qf_encode($fertilizer)."'";//道具
}

$nextExp = qf_toExp(qf_toLevel($levelup_exp) + 1); //The value of the next level of experience
$_QFG['db']->query("UPDATE app_qqfarm_nc set levelup={$nextExp}{$levelup_sql} where uid=". $_QFG['uid']);

?>